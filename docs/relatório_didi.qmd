---
title: "Cirurgias Dermatol√≥gicas em Nonagen√°rios"
subtitle: "Estudo explorat√≥rio de ex√©rese de c√¢ncer de pele em pacientes ‚â•90 anos"
author: "Jinfy Maria dos Santos Goedert"
date: today
date-format: "DD.MM.YYYY"
lang: pt-BR
format:
  html:
    theme: cosmo
    toc: false
    toc-depth: 3
    toc-location: left
    toc-title: "Navega√ß√£o"
    number-sections: true
    code-fold: true
    code-summary: "Ver c√≥digo"
    fig-width: 8
    fig-height: 5
    fig-dpi: 150
execute:
  echo: false
  warning: false
  message: false
---

```{r}
#| label: setup
#| include: false

# Depend√™ncias
library(dplyr)
library(tidyr)
library(stringr)
library(forcats)
library(ggplot2)
library(gtsummary)
library(gt)
library(scales)

# Dados
proj <- Sys.getenv("QUARTO_PROJECT_DIR", unset = getwd())

pacientes_path <- file.path(proj, "..", "data", "derived", "pacientes.rds")
lesoes_path    <- file.path(proj, "..", "data", "derived", "lesoes.rds")

stopifnot(file.exists(pacientes_path), file.exists(lesoes_path))

pacientes <- readRDS(pacientes_path)
lesoes    <- readRDS(lesoes_path)

# Tema global para gr√°ficos
theme_set(
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold", size = 14),
      plot.subtitle = element_text(color = "gray40"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom"
    )
)

# Fun√ß√£o para formatar n (percentual)
fmt_npct <- function(k, n) sprintf("%d (%.1f%%)", k, 100 * k / n)

# Paleta de cores
cores <- c(
  cbc = "#2E86AB",
  cec = "#A23B72",
  fem = "#E85D75",
  masc = "#4A90A4"
)
```

# Antes de tudo...

Hello didi, t√¥ tentando fazer a an√°lise de jeito que d√™ pra ver o que est√° acontecendo (e j√° ir pensando junto no que isso significa pro teu trabalho).

**O que temos em m√µes:**

-   **`r nrow(pacientes)` pacientes** no total
-   **`r nrow(lesoes)` les√µes** operadas no total

Eu no come√ßo pensava que com um n baixo n√£o teria teste estat√≠stico, p-valor, intervalo de confian√ßa... Mas eu fui testar como quem n√£o quer nada e... p \< 0.01

De qualquer forma acho que o mais importante pro teu trabalho agora √© a an√°lise descritiva

------------------------------------------------------------------------

# Quem s√£o esses velhos?

## O b√°sico: idade, sexo, fototipo

```{r}
#| label: tbl-demografica
#| tbl-cap: "Caracter√≠sticas dos pacientes"

pacientes |>
  mutate(
    sexo_label = factor(sexo, c("f", "m"), c("Feminino", "Masculino")),
    fototipo = factor(fototipo)
  ) |>
  select(
    idade, sexo_label, fototipo,
    cbc_cec_previo, mohs, mais_cx, obito
  ) |>
  tbl_summary(
    label = list(
      idade ~ "Idade (anos)",
      sexo_label ~ "Sexo",
      fototipo ~ "Fototipo (Fitzpatrick)",
      cbc_cec_previo ~ "J√° teve CBC/CEC antes",
      mohs ~ "Fez Mohs",
      mais_cx ~ "Teve outras cirurgias",
      obito ~ "Faleceu no seguimento"
    ),
    statistic = list(
      all_continuous() ~ "{median} ({p25}‚Äì{p75})",
      all_categorical() ~ "{n} ({p}%)"
    ),
    digits = list(
      all_continuous() ~ 1,
      all_categorical() ~ c(0, 1)
    ),
    missing = "no"
  ) |>
  bold_labels() |>
  as_gt() |>
  tab_header(
    title = "Tabela 1 ‚Äî Quem s√£o os pacientes",
    subtitle = paste0("N = ", nrow(pacientes))
  )
```

```{r}
#| label: fig-idade
#| fig-cap: "Distribui√ß√£o de idade"

pacientes |>
  ggplot(aes(x = idade)) +
  geom_histogram(binwidth = 1, fill = cores["cbc"], color = "white", alpha = 0.8) +
  geom_vline(
    xintercept = median(pacientes$idade),
    linetype = "dashed", color = "gray30", linewidth = 0.8
  ) +
  annotate(
    "text",
    x = median(pacientes$idade) + 0.5,
    y = Inf, vjust = 2, hjust = 0,
    label = paste0("Mediana: ", median(pacientes$idade), " anos"),
    size = 3.5, color = "gray30"
  ) +
  scale_x_continuous(breaks = seq(90, 110, 2)) +
  labs(
    x = "Idade (anos)",
    y = "N√∫mero de pacientes",
    title = "A idade dos teus pacientes",
    subtitle = "Todo mundo tem 90+, mas olha a varia√ß√£o!"
  )
```

Olha que interessante: a [mediana](#nota-definicoes) √© `r median(pacientes$idade)` anos. Isso significa que metade dos teus pacientes tem **mais** que isso. √â uma popula√ß√£o bem idosa mesmo ‚Äî o que faz total sentido pro teu recorte.

::: callout-note
## Por que vamos usar mediana e n√£o m√©dia?

~~Gata, eu tamb√©m consigo aparecer em forma de bal√£ozinho. Sou muito foda~~

Sim, eu tamb√©m gosto da **m√©dia**. Ela √© um √≥timo resumo estat√≠stico quando os dados s√£o sim√©tricos (ou seja, quando os valores giram em torno de um ponto central).

S√≥ que como d√° pra ver no @fig-idade, a nossa amostra √© assim√©trica (d√° pra ver direitinho que a maior massa de pacientes t√° √† esquerda), e isso distorce a m√©dia. Por esse motivo, ela n√£o √© a primeira linha no nosso caso.

A **mediana**, n√£o sei se tu lembra, √© exatamente o valor que divide a amostra em duas metades iguais. Metade dos pacientes tem idade menor que a mediana, e metade maior. Ela acaba sendo bem mais robusta quando a gente lida com valores extremos (tipo um paciente com 110 anos) e d√° uma ideia melhor do "centro" quando os dados n√£o se comportam de um jeito "bonitinho" em torno do centro.
:::

## E as comorbidades?

Quase ningu√©m chega nos 90 "zerado", n√©?

```{r}
#| label: fig-comorbidades
#| fig-cap: "As comorbidades mais comuns"

comorb_cols <- c("has", "dm", "dlp", "ic", "fa", "drc", "alzheimer", "parkinson", "dpoc")
comorb_labels <- c(
  has = "Hipertens√£o", dm = "Diabetes", dlp = "Dislipidemia",
  ic = "Insuf. card√≠aca", fa = "Fibrila√ß√£o atrial", drc = "Doen√ßa renal cr√¥nica",
  alzheimer = "Alzheimer", parkinson = "Parkinson", dpoc = "DPOC"
)

comorb_prev <- pacientes |>
  summarise(across(all_of(comorb_cols), ~ sum(.x, na.rm = TRUE))) |>
  pivot_longer(everything(), names_to = "comorbidade", values_to = "n") |>
  mutate(
    pct = n / nrow(pacientes) * 100,
    label = comorb_labels[comorbidade],
    label = fct_reorder(label, pct)
  )

comorb_prev |>
  ggplot(aes(x = label, y = pct)) +
  geom_col(fill = cores["cbc"], width = 0.7) +
  geom_text(aes(label = sprintf("%.0f%%", pct)), hjust = -0.2, size = 3.5) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 100), labels = \(x) paste0(x, "%")) +
  labs(
    x = NULL,
    y = "Preval√™ncia",
    title = "O que eles t√™m al√©m do c√¢ncer de pele",
    subtitle = "Spoiler: hipertens√£o lidera disparado"
  )
```

Nenhuma surpresa: **hipertens√£o** √© a campe√£. Mas repara na quantidade de comorbidades cardiovasculares e neurol√≥gicas. Isso pode ser um ponto interessante pra discuss√£o ‚Äî essa popula√ß√£o n√£o √© trivial de operar

## Quantas les√µes por paciente?

Aqui tem um detalhe metodol√≥gico importante:

```{r}
#| label: tbl-carga-lesoes

lesoes_por_pac <- lesoes |>
  count(paciente, name = "n_lesoes") |>
  count(n_lesoes, name = "n_pacientes") |>
  mutate(
    pct = n_pacientes / sum(n_pacientes) * 100,
    pct_fmt = sprintf("%.1f%%", pct)
  )

lesoes_por_pac |>
  select(`Les√µes` = n_lesoes, `Pacientes` = n_pacientes, `%` = pct_fmt) |>
  gt() |>
  tab_header(
    title = "Quantas les√µes cada paciente teve?",
    subtitle = "A maioria tem uma, mas tem gente com v√°rias"
  ) |>
  cols_align(align = "center")
```

```{r}
#| label: calcula-multiplas

n_multiplas <- sum(lesoes_por_pac$n_pacientes[lesoes_por_pac$n_lesoes > 1])
pct_multiplas <- n_multiplas / nrow(pacientes) * 100
```

`r n_multiplas` pacientes (quase metade, `r sprintf("%.1f", pct_multiplas)`%) t√™m mais de uma les√£o.

------------------------------------------------------------------------

# Les√µes: protagonistas, coadjuvantes e participa√ß√µes especiais

Agora olhando pras les√µes em si o n engorda (s√£o 111!!!)

::: callout-note
## Ponto de aten√ß√£o

Quando a gente for fazer an√°lise estat√≠stica les√£o por les√£o, essas les√µes do mesmo paciente n√£o s√£o independentes. O mesmo paciente que teve uma complica√ß√£o na ex√©rese de uma les√£o pode ter predisposi√ß√£o a ter complica√ß√µes em outra. Agora eu t√¥ com pregui√ßa, mas a gente vai ter que pensar nisso mais tarde
:::

## CBC ou CEC?

```{r}
#| label: fig-tipo-histo
#| fig-cap: "A divis√£o b√°sica: CBC vs CEC"

lesoes |>
  filter(!is.na(histo_tipo)) |>
  count(histo_tipo) |>
  mutate(
    pct = n / sum(n) * 100,
    label = toupper(histo_tipo),
    label = fct_reorder(label, n, .desc = TRUE)
  ) |>
  ggplot(aes(x = label, y = n, fill = histo_tipo)) +
  geom_col(width = 0.5) +
  geom_text(
    aes(label = sprintf("%d\n(%.1f%%)", n, pct)),
    vjust = -0.3, size = 4, fontface = "bold"
  ) +
  scale_fill_manual(values = cores[c("cbc", "cec")], guide = "none") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x = NULL,
    y = "N√∫mero de les√µes",
    title = "CBC domina, como esperado",
    subtitle = paste0("Total: ", nrow(lesoes), " les√µes")
  )
```

```{r}
#| label: calc-tipos
pct_cbc <- mean(lesoes$histo_tipo == "cbc", na.rm = TRUE) * 100
pct_cec <- mean(lesoes$histo_tipo == "cec", na.rm = TRUE) * 100
```

CBC representa `r sprintf("%.0f", pct_cbc)`% das les√µes. O basocelular √© o mais comum mesmo (eu li na Wikip√©dia), mas os `r sprintf("%.0f", pct_cec)`% de CEC s√£o mais agressivos (fonte: ChatGPT)

## Os subtipos do CBC

Isso aqui √© babado pra discuss√£o

```{r}
#| label: fig-subtipos-cbc
#| fig-cap: "Quais subtipos de CBC aparecem?"

lesoes |>
  filter(histo_tipo == "cbc", !is.na(histo_subtipo), histo_subtipo != "") |>
  separate_rows(histo_subtipo, sep = ", ") |>
  count(histo_subtipo) |>
  mutate(histo_subtipo = fct_reorder(histo_subtipo, n)) |>
  ggplot(aes(x = histo_subtipo, y = n)) +
  geom_col(fill = cores["cbc"], width = 0.7) +
  geom_text(aes(label = n), hjust = -0.3, size = 3.5) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x = NULL,
    y = "Frequ√™ncia",
    title = "Subtipos histol√≥gicos do CBC",
    subtitle = "Nodular lidera, mas tem bastante infiltrativo tamb√©m"
  )
```

**Nodular** √© o mais comum. Mas tem uma quantidade razo√°vel de **infiltrativo** e **s√≥lido** ‚Äî esses s√£o os que d√£o mais trabalho, com margens mal definidas.

Sobre o NA: tem uma les√£o que n√£o tem subtipo registrado, mas d√° pra filtrar fora no gr√°fico oficial

Isso pode render uma tabela 2x2: ser√° que os subtipos mais agressivos t√™m mais margem comprometida?

## CECs: quem s√£o, onde est√£o e como se apresentam

```{r}
#| label: tbl-cec-comportamento
#| tbl-cap: "Caracter√≠sticas do CEC"

n_cec <- sum(lesoes$histo_tipo == "cec", na.rm = TRUE)

lesoes |>
  filter(histo_tipo == "cec") |>
  select(histo_difer, comport) |>
  tbl_summary(
    label = list(
      histo_difer ~ "Diferencia√ß√£o",
      comport ~ "Comportamento"
    ),
    statistic = all_categorical() ~ "{n} ({p}%)",
    missing_text = "N√£o especificado"
  ) |>
  bold_labels() |>
  as_gt() |>
  tab_header(
    title = "O perfil dos CECs",
    subtitle = paste0("N = ", n_cec, " les√µes")
  )
```

## LOcal das les√µes

```{r}
#| label: fig-localizacao
#| fig-cap: "Mapa anat√¥mico das les√µes"

lesoes_local <- lesoes |>
  mutate(
    local_grupo = case_when(
      localizacao %in% c("face", "orelha") ~ "Face/Orelha",
      localizacao == "couro cabeludo" ~ "Couro cabeludo",
      localizacao %in% c("t√≥rax", "dorso") ~ "Tronco",
      localizacao == "cervical" ~ "Cervical",
      str_detect(localizacao, "membro superior|antebra√ßo") ~ "Membro superior",
      str_detect(localizacao, "membro inferior|p√©") ~ "Membro inferior",
      TRUE ~ "Outro"
    )
  )

lesoes_local |>
  filter(!is.na(local_grupo)) |>
  count(local_grupo, histo_tipo) |>
  mutate(
    histo_tipo = toupper(histo_tipo),
    local_grupo = fct_reorder(local_grupo, n, .fun = sum)
  ) |>
  ggplot(aes(x = local_grupo, y = n, fill = histo_tipo)) +
  geom_col(width = 0.7) +
  geom_text(
    aes(label = n),
    position = position_stack(vjust = 0.5),
    color = "white", fontface = "bold", size = 3.5
  ) +
  coord_flip() +
  scale_fill_manual(values = cores[c("cbc", "cec")]) +
  labs(
    x = NULL,
    y = "N√∫mero de les√µes",
    fill = "Tipo",
    title = "Onde est√£o as les√µes?",
    subtitle = "Face/orelha domina ‚Äî faz sentido, √© √°rea fotoexposta"
  )
```

Sem surpresas, n√©? Agora sobre esses n√∫meros malucos nem me pergunte, o R colocou sozinho mas vou tirar depois

------------------------------------------------------------------------

# Como voc√™s fecharam?

## T√©cnicas utilizadas

```{r}
#| label: tbl-fechamento
#| tbl-cap: "T√©cnicas de fechamento"

lesoes |>
  filter(!is.na(fech)) |>
  mutate(
    fech_label = case_when(
      fech == "direto" ~ "Fechamento direto",
      fech == "retalho" ~ "Retalho",
      fech == "enxerto" ~ "Enxerto",
      fech == "2intencao" ~ "Segunda inten√ß√£o",
      TRUE ~ fech
    ),
    tipo = toupper(histo_tipo)
  ) |>
  select(fech_label, tipo) |>
  tbl_summary(
    by = tipo,
    label = list(fech_label ~ "T√©cnica"),
    statistic = all_categorical() ~ "{n} ({p}%)"
  ) |>
  add_overall(last = TRUE) |>
  bold_labels() |>
  as_gt() |>
  tab_header(
    title = "Como fecharam as feridas?",
    subtitle = "Por tipo histol√≥gico"
  )
```

Fechamento direto √© o mais comum ‚Äî faz sentido, √© o mais simples quando d√°. Mas tem bastante retalho e enxerto tamb√©m, o que mostra que as les√µes n√£o eram todas triviais.

**Pergunta que pode surgir:** ser√° que a t√©cnica de fechamento influencia a taxa de complica√ß√£o? (spoiler: provavelmente sim, mas a gente vai ver isso na an√°lise inferencial)

------------------------------------------------------------------------

# Os desfechos: o que aconteceu?

## Margens cir√∫rgicas

```{r}
#| label: fig-margens
#| fig-cap: "Resultado das margens"

lesoes |>
  filter(!is.na(margens_ap)) |>
  mutate(
    margens_status = case_when(
      str_detect(margens_ap, "comprometida") ~ "Comprometidas",
      margens_ap == "livres" ~ "Livres",
      TRUE ~ "Outro"
    )
  ) |>
  count(margens_status) |>
  mutate(
    pct = n / sum(n) * 100,
    margens_status = fct_reorder(margens_status, n, .desc = TRUE)
  ) |>
  ggplot(aes(x = margens_status, y = n, fill = margens_status)) +
  geom_col(width = 0.5) +
  geom_text(
    aes(label = sprintf("%d (%.1f%%)", n, pct)),
    vjust = -0.3, size = 4
  ) +
  scale_fill_manual(
    values = c("Livres" = "#2A9D8F", "Comprometidas" = "#E63946", "Outro" = "gray60"),
    guide = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x = NULL,
    y = "N√∫mero de les√µes",
    title = "As margens ficaram livres?",
    subtitle = "Esse √© um dos desfechos mais importantes"
  )
```

```{r}
#| label: calc-margens
pct_livres <- lesoes |>
  filter(!is.na(margens_ap)) |>
  summarise(pct = mean(margens_ap == "livres", na.rm = TRUE) * 100) |>
  pull(pct)
```

A maioria das margens veio livre ‚Äî isso √© bom! Mas tem `r sprintf("%.1f", 100 - pct_livres)`% de margens comprometidas ou parcialmente comprometidas.

Esses casos devem estar ligados diretamente √† reinterven√ß√£o ou acompanhamento mais pr√≥ximo. Pode ser interessante ver se tem algum padr√£o: tipo histol√≥gico, localiza√ß√£o, subtipo...

## Complica√ß√µes e reinterven√ß√µes

```{r}
#| label: tbl-desfechos
#| tbl-cap: "Desfechos adversos"

lesoes |>
  mutate(
    teve_complicacao = !is.na(complicacao) & complicacao != "",
    teve_reintervencao = reintervencao == TRUE
  ) |>
  select(teve_complicacao, teve_reintervencao) |>
  tbl_summary(
    label = list(
      teve_complicacao ~ "Teve complica√ß√£o",
      teve_reintervencao ~ "Precisou reintervir"
    ),
    statistic = all_categorical() ~ "{n} ({p}%)"
  ) |>
  bold_labels() |>
  as_gt() |>
  tab_header(
    title = "Deu problema?",
    subtitle = paste0("N = ", nrow(lesoes), " les√µes")
  )
```

```{r}
#| label: fig-complicacoes
#| fig-cap: "Tipos de complica√ß√£o"

complicacoes <- lesoes |>
  filter(!is.na(complicacao), complicacao != "") |>
  separate_rows(complicacao, sep = ",\\s*") |>
  count(complicacao) |>
  filter(n > 0)

if (nrow(complicacoes) > 0) {
  complicacoes |>
    mutate(complicacao = fct_reorder(complicacao, n)) |>
    ggplot(aes(x = complicacao, y = n)) +
    geom_col(fill = "#E63946", width = 0.6) +
    geom_text(aes(label = n), hjust = -0.3, size = 4) +
    coord_flip() +
    scale_y_continuous(expand = expansion(mult = c(0, 0.2))) +
    labs(
      x = NULL,
      y = "Casos",
      title = "Quando complicou, o que foi?",
      subtitle = "Os tipos de complica√ß√£o observados"
    )
} else {
  cat("Boa not√≠cia: nenhuma complica√ß√£o registrada!")
}
```

Um dos desfechos mais foda do teu trabalho: perfil de seguran√ßa do procedimento nos 90+. Gente velha, com v√°rias comorbidades, mas mesmo assim a taxa de complica√ß√£o √© relativamente baixa.

------------------------------------------------------------------------

# Checando a consist√™ncia dos dados

Antes de a gente confiar 100% nos dados, deixa eu te mostrar uma verifica√ß√£o r√°pida:

```{r}
#| label: tbl-consistencia
#| tbl-cap: "Atributos por tipo histol√≥gico"

# ---- helpers ----
fmt_npct <- function(k, n) sprintf("%d (%.1f%%)", k, 100 * k / n)
indent <- function(x, n = 6) paste0(strrep("\u00A0", n), x)

# ---- dados (autossuficiente) ----
col_comp_txt <- "complicacao"  # ajusta se for outro nome

lesoes_fix <- lesoes %>%
  mutate(
    complicacoes_txt = str_squish(as.character(.data[[col_comp_txt]])),
    complicacoes_txt = na_if(complicacoes_txt, ""),
    teve_complicacao = !is.na(complicacoes_txt),

    reintervencao = as.logical(reintervencao),
    reintervencao = if_else(is.na(reintervencao), FALSE, reintervencao),

    sem_intercorrencias = !teve_complicacao & !reintervencao
  )

n_total <- nrow(lesoes_fix)

# ---- linhas principais ----
main <- tibble(
  Grupo = c("Complica√ß√£o", "Reinterven√ß√£o", "Sem intercorr√™ncias"),
  n = c(
    sum(lesoes_fix$teve_complicacao),
    sum(lesoes_fix$reintervencao),
    sum(lesoes_fix$sem_intercorrencias)
  )
) %>%
  mutate(`n (%)` = fmt_npct(n, n_total)) %>%
  select(Grupo, `n (%)`)

# ---- tipos de complica√ß√£o ----
comp_types <- lesoes_fix %>%
  filter(!is.na(complicacoes_txt)) %>%
  mutate(complicacoes_txt = str_to_lower(complicacoes_txt)) %>%
  separate_rows(complicacoes_txt, sep = "\\s*,\\s*") %>%
  mutate(complicacoes_txt = str_squish(complicacoes_txt)) %>%
  filter(complicacoes_txt != "") %>%
  count(complicacoes_txt, sort = TRUE, name = "n") %>%
  mutate(
    Grupo = indent(str_to_sentence(complicacoes_txt)),
    `n (%)` = fmt_npct(n, n_total)
  ) %>%
  select(Grupo, `n (%)`)

tab <- bind_rows(
  main %>% slice(1),
  comp_types,
  main %>% slice(2:3)
)

# ---- tabela ----
tab %>%
  gt() %>%
  tab_header(
    title = "Complica√ß√µes e reinterven√ß√µes",
    subtitle = sprintf("N = %d les√µes", n_total)
  ) %>%
  cols_label(
    Grupo = "Eventos adversos",
    `n (%)` = "n (%)"
  ) %>%
  cols_align("left", Grupo) %>%
  cols_align("right", `n (%)`) %>%
  tab_footnote(
    footnote = "Uma les√£o pode apresentar mais de um tipo de complica√ß√£o; por isso, as subcategorias podem somar mais do que o total de complica√ß√µes.",
    locations = cells_body(columns = Grupo, rows = 1)
  )
```

::: callout-warning
## Eu sou ignorante

Aqui eu ~~estudei uma revis√£o publicada no New England e li mais dois artigos do Lancet pra checar se a minha interpreta√ß√£o dos dados est√° correta~~ consultei o ChatGPT (eu espero que ele n√£o tenha alucinado)
:::

Pelo que entendi, certos atributos s√≥ fazem sentido pra certos tipos histol√≥gicos: - **CBC** deve ter subtipo (nodular, infiltrativo, etc.), n√£o diferencia√ß√£o - **CEC** deve ter diferencia√ß√£o e \*\*comportamento, n√£o subtipo

It's tricky

------------------------------------------------------------------------

# Resumo da √≥pera

```{r}
#| label: resumo-final

n_pac <- nrow(pacientes)
n_les <- nrow(lesoes)
idade_med <- median(pacientes$idade)
pct_fem <- mean(pacientes$sexo == "f", na.rm = TRUE) * 100
pct_cbc <- mean(lesoes$histo_tipo == "cbc", na.rm = TRUE) * 100
pct_complic <- mean(!is.na(lesoes$complicacao) & lesoes$complicacao != "", na.rm = TRUE) * 100
```

| O que               | Quanto                                   |
|---------------------|------------------------------------------|
| Pacientes           | `r n_pac`                                |
| Les√µes operadas     | `r n_les`                                |
| Idade mediana       | `r idade_med` anos                       |
| Mulheres            | `r sprintf("%.0f", pct_fem)`%            |
| CBC                 | `r sprintf("%.0f", pct_cbc)`% das les√µes |
| Taxa de complica√ß√£o | `r sprintf("%.1f", pct_complic)`%        |

------------------------------------------------------------------------

# E agora, pra onde a gente vai?

Com base no que vimos, essas s√£o as perguntas que eu acho que valem a pena investigar:

### 1. O que aumenta o risco de complica√ß√£o?

Idade? N√∫mero de comorbidades? T√©cnica de fechamento? Tipo de tumor?

### 2. O que leva a margem comprometida?

Subtipo histol√≥gico (infiltrativo vs nodular)? Localiza√ß√£o? Tamanho?

### 3. CEC invasivo √© diferente?

Os pacientes com CEC invasivo t√™m perfil diferente dos com CEC in situ?

### 4. Retalho e enxerto complicam mais?

Comparando com fechamento direto e segunda inten√ß√£o.

------------------------------------------------------------------------

## Pr√≥ximos passos concretos

-   [ ] Definir quais vari√°veis v√£o entrar nos modelos
-   [ ] Pensar se estratifica por tipo histol√≥gico ou ajusta
-   [ ] Decidir como lidar com m√∫ltiplas les√µes do mesmo paciente
-   [ ] Escrever a se√ß√£o de m√©todos (essa parte descritiva j√° d√° pra adiantar!)

------------------------------------------------------------------------

**Uma coisa importante:** tudo que est√° aqui √© descritivo. A gente n√£o pode dizer que X *causa* Y ainda. Mas agora tu tem uma vis√£o clara da tua amostra, e isso √© fundamental pra montar a an√°lise direito.

Me conta o que tu achou! üéØ

------------------------------------------------------------------------

*Gerado em `r format(Sys.time(), "%d/%m/%Y √†s %H:%M")`*
